<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>todoApp@nsktdeluxe</title>
        <link rel="stylesheet" href="./style.css">
        <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    </head>
    <body>
        <header>
            <h1 class="title">todoApp@nsktdeluxe</h1>
        </header>
        <div class="container">
        <div>
            <h4><i class="fas fa-walking"></i> つかいかた</h4>
            <span>作成ボタンをクリックして、やることのタイトルと内容を入力したら、保存ボタンをおしてね</span><br/>
            <i class="fas fa-check-square"></i><span>：完了チェックができます</span><br />
            <i class="fas fa-trash"></i><span>：つくったTodoを削除します</span>
        </div>
        <div class="btn_area">
            <button type="button" class="btn btn-lg" id="btn_todo">やること作成！</button>
        </div>
        <div class="todo_area">
            <ul id="todo-list-ul">
                <!-- ここにやることがでてくる -->
            </ul>
        </div>
        <div class="modal" id="modal-todo">
            <h4>やること</h4>
            <div class="btn_close" id="modal-close">
                <span>閉じる</span>
                <i class="fas fa-window-close"></i>
            </div>
            <form id="input-form">
                <!-- タイトル -->
                <div>
                    <h5>タイトル：</h5>
                    <input type="text" size="50" id="todo-title" placeholder="なにをやるか！">
                </div>
                <!-- 内容 -->
                <div>
                    <h5>内容　　：</h5>
                    <input type="text" size="100" id="todo-content" placeholder="どんなことやるか！">
                </div>
                <!-- 保存 -->
                <div>
                    <input type="button" class="btn btn-sm" value="保存" id="todo_submit">
                </div>
            </form>
        </div>
        </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="./script.js" ></script>
    <script>
    $(function() {
    // ヘッダーの高さ分だけコンテンツを下げる
        var height=$('header').height();
        $('body').css('margin-top', height + 15);// 15pxだけ余裕をもたせる
    });

    $('#btn_todo').click(function(){
    // やることモーダルオープン
        // オーバーレイ用のHTMLコードを、[body]内の最後に生成する
        $('body').append('<div id="modal-overlay"></div>');

        // [$modal-overlay][$modal-todo]をフェードインさせる
        $('#modal-overlay').fadeIn('slow');
        centeringModalSyncer();
        $('#modal-todo').fadeIn('slow');
    });

    function centeringModalSyncer(){
    // センタリングをする関数
        // 画面(ウィンドウ)の幅を取得し、変数[w]に格納
        var w = $(window).width();

        // 画面(ウィンドウ)の高さを取得し、変数[h]に格納
        var h = $(window).height();

        // コンテンツ(#modal-todo)の幅を取得し、変数[cw]に格納
        var cw = $('#modal-todo').outerWidth();

        // コンテンツ(#modal-todo)の高さを取得し、変数[ch]に格納
        var ch = $('#modal-todo').outerHeight();

        // コンテンツ(#modal-content)を真ん中に配置するのに、左端から何ピクセル離せばいいか？を計算して、変数[pxleft]に格納
        var pxleft = ((w - cw)/2);

        // コンテンツ(#modal-todo)を真ん中に配置するのに、上部から何ピクセル離せばいいか？を計算して、変数[pxtop]に格納
        var pxtop = ((h - ch)/2);

        // [#modal-todo]のCSSに[left]の値(pxleft)を設定
        $('#modal-todo').css({"left": pxleft + 'px'});

        // [#modal-todo]のCSSに[top]の値(pxtop)を設定
        $('#modal-todo').css({"top": pxtop + 'px'});
    }

    $('#modal-overlay,#modal-close').unbind().click(function(){
    // モーダル閉じる
        $('#modal-todo, #modal-overlay').fadeOut('slow',function(){
            //フェードアウト後、[#modal-overlay]をHTML(DOM)上から削除
            $('#modal-overlay').remove();
            // フォームをリセットする
            $('#input-form')[0].reset();
        });
    });
    
    $('#todo_submit').click(function(){
    // 保存ボタン押下時処理
    var todoTitle = $('#todo-title').val();
    var todoContent = $('#todo-content').val();
        if(todoTitle =='' || todoContent == ''){
        // 空入力チェック
            alert('どっちも必須入力です！');
            return false;
        }
        
        // 元画面にやることリストを生成する
        $('#todo-list-ul').append(`<li class="todo_list" id="">
                    <div class="todo_list_title" id=""><span>`+ todoTitle +`</span></div>
                    <div class="todo_list_content" id=""><span>` + todoContent + `</span></div>
                    <div class="todo_icon_area"><input type="checkbox" name="done" class="check_done" id=""><i class="fas fa-trash" name="delete" id=""></i></div></li>`);
        
        $('#modal-todo, #modal-overlay').fadeOut('slow', function(){
            // フェードアウト後、[#modal-overlay]をHTML(DOM)上から削除
            $('#modal-overlay').remove();
            // フォームをリセットする
            $('#input-form')[0].reset();
        });
    });
        
    // 完了未完チェックのイベント
    $(document).on('click', 'input[type="checkbox"]', function(){
        if($(this).prop('checked') == true) {
            // 取り消し線をつける
            // TODO: 完了/未完了ラベルをつける
            // HACK: もうちょっとスマートな書き方みつける
            $(this).parents().children('.todo_list_title').css('text-decoration','line-through');
            $(this).parents().children('.todo_list_content').css('text-decoration','line-through');
        } else {
            $(this).parents().children('.todo_list_title').css('text-decoration','none');
            $(this).parents().children('.todo_list_content').css('text-decoration','none');
        }
    });
    
    $(document).on('click', '.fa-trash', function(){
    // todoを削除する
    // FIXME:うごかん
        $(this).parent('li').remove();
    });
    </script>
</html>